<%- include('bootheader') -%>
<%- include('menubar') -%>
<div class="p-3 mb-4 bg-light">
  <div class="container-fluid ">
    <h1 class="pb-2 border-bottom">
      <%= problemSet.name.trim() || "Problem Set" %>
      (<%= problemSet.status %>)
      <% if (isOwner){%> 
      <a href="/editProblemSet/<%=courseId%>/<%= psetId %>" >
        <i class='fas fa-pen' style='font-size:24px'></i> 
     </a>
     <% } %>
    </h1>
    
    <div>
      <% if (problemSet.status=="in-prep") { %>
        <p>
          This problem set is still in preparation. 
          It is not visible to students. You can now add problems to it.
          When you are done adding problems, you can release it to students
          by clicking the "Release" button below. You will then be able to
          print personalized exams for students.
        </p>
       <% } else if (problemSet.status=="released") {%>
        <p>

          <b>This problem set has been released. </b>
          You can now print personalized exams for students, and if you have enabled
          in-app grading, students will be able to upload their answers to the site.
          When the exam has been completed, you can grade it by clicking the "Grade"
          button below.

         
        </p>

        <% } else if (problemSet.status=="grading") {%>
          <p><i>
            The problem set can now be graded. When you have completed the grading,
            you can change the status to "graded" by clicking the "Post Grades" button below.
            Students will then be able to see their grades on this exam.
          </i>
          </p>


        <% } else if (problemSet.status=="graded") {%>
          The problem set has been graded. 
          If you are not done grading then click the "Return to grading" button below.
          <% } %>

    </div>
    <div class="p-2">
      <h2>Problems
        <% if (isOwner){%> 
          <% if (problemSet.status=='in-prep') { %>

            <a href="/addProblem/<%= courseId%>/<%= psetId %>">
              <i class='fas fa-plus' style='font-size:24px'></i> 
            </a>
           <% } %>
        <% } %>
      </h2>
      <ul>
        <% for(i=0; i<problems.length; i++){ 
          if (!problems[i].visible && !isOwner ) { %>
          <li>Problem Hidden </li>
          <% } else {%>
          <li>




         
                <a href="/showProblem/<%= courseId%>/<%= psetId %>/<%= problems[i]._id %>">
                    <%= problems[i].description || "no name" %>
                </a>
                <% // the owner can remove the problem from the problem set
                if (isOwner){ %>
                 <a href="/removeProblem/<%= courseId%>/<%= psetId %>/<%= problems[i]._id %>">
                   <i class='fas fa-xmark' style='font-size:24px'></i> 
                 </a>


             <% } %>



          <% } %>
        </li>
        <% } %>
      </ul>


      <hr>
      <% if (isOwner && (problemSet.status=='released')){ %>

     


      <a href="/downloadAsTexFile/<%=courseId%>/<%= psetId %>" 
        class="btn btn-sm btn-info">
        Download as .tex file
      </a>

      <a href="/downloadPersonalizedExamsAsTexFile/<%=courseId%>/<%= psetId %>" 
        class="btn btn-sm btn-info">
        Download personalized exams
      </a>
      <% } %>
     
      <% if (isOwner 
            && (problemSet.status=="graded")
            && !(problemSet.makeup || problemSet.makeupOf)
            ) { %>
        <h3>Makeup Exams</h3>
        If you want to create a makeup exam for this problem set, click the button below.
        It will let you create a new problem set, but when you print 
        the personalized exams, it will only create exams for those students
        who missed this (the original) exam.
        <br>
        <form method="post"
            action="/saveProblemSet/<%=courseId%>">
          <input type="hidden" name="psetId" value="<%=psetId%>">
          <input type="hidden" name="makeupOf" value="<%=psetId%>">
          <input type="hidden" name="name" value="Makeup For <%=problemSet.name%>">
          <input type="submit" value="Create Makeup Exam">
        </form>
        <br><hr><br>
        <% } %>


      <% if (isStaff && problemSet.status=='grading') { %>
        <h2>Grading</h2>
        <% if (course.courseType!="mla0") {%>
          <a class="btn btn-sm btn-danger" 
            href="/gradeProblemSet/<%= courseId%>/<%= problemSet._id %>">
            Grade Problem Set
          </a>

          <a class="btn btn-sm btn-danger" 
            href="/gradeProblemSet/<%= courseId%>/<%= problemSet._id %>/json">
            show JSON grades
          </a>
        <% } else { %>
          <p>Select a CSV file containing the grades
          <br> The first row should be the column names: <b>name,email,S1,S2,...,Sk</b>
          <br> where the S1,...,Sk are the short names of the skills tested
            in this problem set
            <br> the values in the rows should be 
            1 (or 1.0) if they mastered the skill, 
            0 (or 0.0) if they did not master the skill on this exam 
            (but may have mastered it in the past),
            Every column must have a 1 or a 0 in it.
          </p>
        
          <form method="post" 
            action="/uploadGrades/<%= courseId %>" 
            enctype="multipart/form-data">

          
          
        
          
          

          Grades for <%= problemSet.name.trim() || "Problem Set" %>
          <input type="hidden" 
                 name="psetId" 
                 value="<%= problemSet._id %>"             
                 >

          <input required class="mb-3" type="file" name="grades" >
          <input class="btn btn-sm btn-primary" type="submit" value="upload grades file (csv)">

      </form>
         
      <% } %>
<hr>
      <% } %>

      <% if (isOwner) { %>
      <div>
        <% if (problemSet.status=="in-prep") { %>
          <p>

            <form method="post" action="/updatePsetStatus/<%= courseId%>/<%= psetId%>">
              <input type="hidden" name="status" value="released">
              <input type="submit" value="Release">
            </form>
          </p>
         <% } else if (problemSet.status=="released") {%>
          <p>
  

            <form method="post" action="/updatePsetStatus/<%= courseId%>/<%= psetId%>">
              <input type="hidden" name="status" value="grading">
              <input type="submit" value="Start Grading">
            </form>
            or  
            <form method="post" action="/updatePsetStatus/<%= courseId%>/<%= psetId%>">
              <input type="hidden" name="status" value="in-prep">
              <input type="submit" value="Go back and add more problems">
            </form>
           
          </p>
  
          <% } else if (problemSet.status=="grading") {%>
            <p>

              <form method="post" action="/updatePsetStatus/<%= courseId%>/<%= psetId%>">
                <input type="hidden" name="status" value="graded">
                <input type="submit" value="Post Grades">
                </form>
              or 
              <form method="post" action="/updatePsetStatus/<%= courseId%>/<%= psetId%>">
                <input type="hidden" name="status" value="released">
                <input type="submit" value="Go back to printing personalized exams">
              </form>
            </p>
  
  
          <% } else  {%>

            <form method="post" action="/updatePsetStatus/<%= courseId%>/<%= psetId%>">
              <input type="hidden" name="status" value="grading">
              <input type="submit" value="Return to grading">
              </form>
            <% } %>
  
      </div>
      <% } %>

      <% if (isOwner) { %>

  
        <% if (problemSet.makeup)  { %>
          <hr>
          <a href="/showProblemSet/<%=courseId%>/<%=problemSet.makeup%>" 
            class="btn btn-sm btn-warning">
            Show Makeup Exam
            </a>
          <% } else  if (problemSet.makeupOf) { %>
            <hr>
            <a href="/showProblemSet/<%=courseId%>/<%=problemSet.makeupOf%>" 
              class="btn btn-sm btn-warning">
              Show Original Exam
              </a>
            <% } %> 
  <hr>
  <br>
        <% } %>
              
          
          <a href="/showCourse/<%= courseId %>" 
            class="btn btn-sm btn-primary">
            Back to List of Problem Sets</a>
    </div>
  </div>
</div>


<%- include('bootfooter') -%>
<%- include('htmlfoot') -%>
